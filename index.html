<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>

  <!-- PWA essentials -->
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/icons/icon-192.png" />

  <!-- iOS PWA support -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="APP Betting">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <title>Adaptive Phase Progression Betting System</title>

  <style>
    :root{--bg:#0b0f14;--card:#121826;--text:#e6eefb;--muted:#9fb0c5;--accent:#4aa3ff;--bad:#ff5a5f;--good:#42d392;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 14px 140px;}
    h1{font-size:18px;margin:0 0 10px;}
    .row{display:flex;gap:12px;flex-wrap:wrap;}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:12px;}
    .grow{flex:1 1 520px;}
    .small{flex:1 1 320px;}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;}
    select,button,input{font-size:14px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:var(--text);padding:10px 12px;}
    select,input{width:100%;}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
    .btn{width:100%;padding:14px 12px;font-weight:800;}
    .btn.good{border-color:rgba(66,211,146,.45);}
    .btn.neutral{border-color:rgba(159,176,197,.35);}
    .btn.primary{border-color:rgba(74,163,255,.55);}
    .btn.ok{border-color:rgba(66,211,146,.55);}
    .btn.danger{border-color:rgba(255,90,95,.55);}
    .btn:disabled{opacity:.45;}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);}
    .k{color:var(--muted);font-size:12px;}
    .v{font-weight:900;}
    .big{font-size:22px;font-weight:950;}
    .muted{color:var(--muted);}
    .sep{height:1px;background:rgba(255,255,255,.08);margin:10px 0;}
    .actions{display:flex;gap:10px;flex-wrap:wrap;}
    .note{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.35;}
    .toggleRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .toggle{display:flex;gap:8px;align-items:center;}
    input[type="checkbox"]{width:18px;height:18px;}
    .log{max-height:360px;overflow:auto;border-radius:12px;border:1px solid rgba(255,255,255,.08);}
    table{width:100%;border-collapse:collapse;font-size:12px;}
    th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left;white-space:nowrap;}
    th{position:sticky;top:0;background:#0f1624;z-index:1;}
    .right{text-align:right;}
    .selectedBox{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px dashed rgba(255,255,255,.18);border-radius:14px;padding:10px 12px;}
    .selectedTag{font-weight:900;}
    .mini{font-size:12px;color:var(--muted);}
    .infoBtn{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:999px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.04);color:var(--text);font-weight:900;cursor:pointer;user-select:none;}
    .footerbar{position:fixed;left:0;right:0;bottom:0;background:rgba(11,15,20,.92);border-top:1px solid rgba(255,255,255,.08);padding:10px 14px;}
    .footerbar .wrap{padding:0;}
    /* modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.58);display:none;align-items:center;justify-content:center;padding:18px;z-index:9999;}
    .modal{width:min(560px,100%);background:#0f1624;border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:14px;}
    .modal h2{margin:0 0 8px;font-size:16px;}
    .modal .content{font-size:14px;line-height:1.45;color:var(--text);}
    .modal .content .muted{color:var(--muted);}
    .modal .btnrow{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;margin-top:12px;}
    .modal .btnrow button{min-width:140px;}

    /* topbar + update bar */
    .topbar{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;margin:0 0 10px;}
    .titleblock{display:flex;flex-direction:column;gap:6px;}
    .subtitle{font-size:12px;color:var(--muted);}
    .top-actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.03);font-size:12px;}
    .badge b{font-size:12px;}
    .updatebar{display:none;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin:10px 0 12px;padding:10px 12px;border-radius:14px;border:1px solid rgba(74,163,255,.35);background:rgba(74,163,255,.08);}
    .updatebar strong{font-size:13px;}
    /* bankroll row fix (prevents overlap) */
    .bankrollRow{display:flex;gap:10px;margin-top:8px;align-items:flex-end;}
    .bankrollRow > div:first-child{flex:1;min-width:0;}
    .bankrollRow > div:last-child{flex:0 0 110px;}
    #applyBankrollBtn{width:100%;}
  </style>
</head>

<body>
<div class="wrap">

  <div class="topbar">
    <div class="titleblock">
      <h1 id="appTitle">Adaptive Phase Progression Betting System</h1>
      <div class="subtitle">Staged input • Auto decisions • CSV export • Optional bankroll manager</div>
    </div>

    <div class="top-actions">
      <span class="badge">Version <b id="versionBadge">—</b></span>
      <button id="openStrategyBtn" class="btn" type="button" style="padding:6px 10px; font-size:12px;">
  Learn Strategy
</button>
      <button class="btn primary" id="installBtn" style="display:none; padding:10px 12px; width:auto;">Install APP Betting</button>
    </div>
  </div>

  <div class="updatebar" id="updateBar">
    <div>
      <strong>Update available</strong>
      <div class="subtitle">A new version has been downloaded. Refresh to apply.</div>
    </div>
    <div class="top-actions">
      <button class="btn primary" id="refreshBtn" style="padding:10px 12px; width:auto;">Refresh</button>
      <button class="btn" id="dismissUpdateBtn" style="padding:10px 12px; width:auto;">Later</button>
    </div>
  </div>

  <!-- YOUR APP UI (unchanged) -->
  <div class="row">
    <div class="card small">
      <label>Game Type</label>
      <select id="gameType">
        <option value="roulette">American Roulette (R/B + Green)</option>
        <option value="baccarat">Vegas Baccarat (Player/Banker + Tie)</option>
      </select>

      <div class="sep"></div>

      <label>Series</label>
      <select id="series">
        <option value="A">Series A</option>
        <option value="B">Series B</option>
      </select>

      <div class="sep"></div>

      <label>Start Mode (used when Carry Mode is OFF)</label>
      <select id="startMode">
        <option value="SAME">SAME</option>
        <option value="OPP">OPPOSITE</option>
      </select>

      <div class="sep"></div>

      <div class="toggleRow">
        <div class="toggle">
          <input type="checkbox" id="autoSeries"/>
          <label style="margin:0;display:flex;gap:8px;align-items:center;">
            Auto Series
            <span class="infoBtn" data-tip="autoSeries">i</span>
          </label>
        </div>
        <div class="toggle">
          <input type="checkbox" id="carryMode"/>
          <label style="margin:0;display:flex;gap:8px;align-items:center;">
            Carry Mode
            <span class="infoBtn" data-tip="carryMode">i</span>
          </label>
        </div>
      </div>

      <div class="sep"></div>

      <label style="display:flex;justify-content:space-between;align-items:center;">
        <span>Bankroll Manager</span>
        <span class="infoBtn" data-tip="bankroll">i</span>
      </label>
      <div class="toggleRow">
        <div class="toggle">
          <input type="checkbox" id="bankrollOn"/>
          <label style="margin:0;">Enable</label>
        </div>
      </div>
      <div class="bankrollRow">
        <div style="flex:1 1 160px; min-width:0;">
          <label>Starting Bankroll</label>
          <input id="bankrollStart" inputmode="decimal" placeholder="e.g., 300"/>
        </div>
       <div style="flex:0 0 104px; display:flex; align-items:flex-end;">
          <button class="btn primary" id="applyBankrollBtn" style="padding:10px 12px;">Apply</button>
       </div>
      </div>
      <div class="note">
        Current Bankroll: <b id="bankrollCurrent">—</b><br/>
        Session Net: <b id="bankrollNet">—</b>
      </div>

      <div class="sep"></div>

      <button class="btn primary" id="newGameBtn">New Game (observe 1 true outcome first)</button>
      <button class="btn ok" id="newEveningBtn" style="margin-top:10px;">New Evening (clear log)</button>
    </div>

    <div class="card grow">
      <div class="row" style="align-items:center;">
        <div class="pill"><span class="k">NEXT SIDE</span> <span class="v big" id="nextSide">—</span></div>
        <div class="pill"><span class="k">NEXT BET</span> <span class="v big" id="nextBet">—</span></div>
        <div class="pill"><span class="k">MODE</span> <span class="v" id="mode">—</span></div>
        <div class="pill"><span class="k">MODE LOSSES</span> <span class="v" id="modeLosses">—</span></div>
        <div class="pill"><span class="k">SERIES</span> <span class="v" id="seriesShow">—</span></div>
        <div class="pill"><span class="k">GAME PnL</span> <span class="v big" id="gamePnL">0</span></div>
      </div>

      <div class="sep"></div>

      <div class="row" style="gap:10px;">
        <div class="pill"><span class="k">STATE</span> <span class="v" id="state">NORMAL</span></div>
        <div class="pill"><span class="k">CONSEC WINS (SAME)</span> <span class="v" id="cw">0</span></div>
        <div class="pill"><span class="k">LADDER BET</span> <span class="v" id="ladderBet">—</span></div>
        <div class="pill"><span class="k">SPLIT LEDGER</span> <span class="v" id="ledger">—</span></div>
        <div class="pill"><span class="k">SPLIT PHASE</span> <span class="v" id="splitPhase">—</span></div>
        <div class="pill"><span class="k">NEXT SPLIT BET</span> <span class="v" id="nextSplitBet">—</span></div>
      </div>

      <div class="sep"></div>

      <div class="selectedBox">
        <div>
          <div class="mini">Selected Outcome (not submitted)</div>
          <div class="selectedTag" id="selectedOutcome">—</div>
        </div>
        <div class="actions">
          <button class="btn" id="clearSelBtn" style="padding:10px 12px;">Clear</button>
          <button class="btn primary" id="submitSelBtn" style="padding:10px 12px;">Submit</button>
          <button class="btn ok" id="undoBtn" style="padding:10px 12px;">Undo</button>
        </div>
      </div>

      <div class="sep"></div>

      <div class="grid" id="buttons"></div>
      <div class="note" id="hint"></div>
    </div>
  </div>

  <div class="row" style="margin-top:12px;">
    <div class="card grow">
      <div class="row" style="align-items:center; justify-content:space-between;">
        <div>
          <div class="muted" style="font-size:12px;">Session Log</div>
          <div style="font-weight:900;">Rows: <span id="logCount">0</span> &nbsp; | &nbsp; Game#: <span id="gameNo">0</span></div>
        </div>
        <div class="actions">
          <button class="btn primary" id="exportCsvBtn" style="padding:10px 12px;">Export CSV</button>
          <button class="btn danger" id="resetSessionBtn" style="padding:10px 12px;">Reset Session</button>
        </div>
      </div>
      <div class="sep"></div>
      <div class="log">
        <table>
          <thead>
          <tr>
            <th>#</th><th>Game#</th><th>Series</th><th>Type</th>
            <th>Outcome</th><th>Pick</th><th class="right">Bet</th>
            <th>Result</th><th class="right">ΔPnL</th><th class="right">GamePnL</th>
            <th>Mode</th><th>State</th><th class="right">Ledger</th><th>Note</th>
          </tr>
          </thead>
          <tbody id="logBody"></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<div class="footerbar" id="footerBar">
  <div class="wrap" style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;">
    <div class="note">
      Rules baked in: NORMAL capped (A:30, B:60). Split triggers only from NORMAL cap-loss (roulette: cap+green counts). Split freezes ladder. Tie during split = push (repeat same split bet). TP ends immediately in SPLIT; TP ends at streak loss in STREAK.
    </div>
    <button id="closeFooterBtn" style="background:none;border:none;color:var(--muted);font-size:16px;cursor:pointer;">✕</button>
  </div>
</div>
</div>

<!-- Tooltip Modal -->
<div class="backdrop" id="tipBackdrop" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="tipTitle">Info</h2>
    <div class="content" id="tipBody"></div>
    <div class="btnrow">
      <button class="btn primary" id="tipCloseBtn">Close</button>
    </div>
  </div>
</div>

<!-- End Game Modal -->
<div class="backdrop" id="endBackdrop" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="endTitle">Game Ended</h2>
    <div class="content" id="endBody"></div>
    <div class="btnrow">
      <button class="btn primary" id="nextGameFromModalBtn">Start Next Game</button>
      <button class="btn" id="closeEndBtn">Close</button>
    </div>
  </div>
</div>

<!-- What's New Modal -->
<div class="backdrop" id="whatsNewBackdrop" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="whatsNewTitle">What’s New</h2>
    <div class="content" id="whatsNewBody"></div>
    <div class="btnrow">
      <button class="btn primary" id="whatsNewCloseBtn">Close</button>
    </div>
  </div>
</div>

<!-- App logic moved here -->
<script src="/app.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const closeBtn = document.getElementById("closeFooterBtn");
  const footer = document.getElementById("footerBar");

  if (closeBtn && footer) {
    closeBtn.addEventListener("click", function () {
      footer.style.display = "none";
    });
  }
});
</script>

</body>
</html>
